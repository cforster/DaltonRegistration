{% extends "registrationApp/base.html" %}
{% load registrationApp_extras %}
{% block headerscript %}



<script type="text/javascript" src="/registrationApp/site_media/Scripts/drop.js"></script>  
<script type="text/javascript">
	function addP(section){
		$( '#result' ).html( '&nbsp;' ).load("{% url add %}", {
			section: section,
			csrfmiddlewaretoken: '{{ csrf_token }}'
       	}).hide().fadeIn('slow');
       	$(' #tabs' ).tabs();
		$(' #tabs' ).tabs("load", 0);
	}

	function switchPeriod(section, studSched){
		$.post("{% url delete %}", { 
		    studSched: studSched,
		   	csrfmiddlewaretoken: '{{ csrf_token }}'
    	})
    	.success(function() { 
    		addP(section);
    		$(' #tabs' ).tabs();
			$(' #tabs' ).tabs("load", 0);
    	 });


	}

	function switchRank(studSched, rank){
		$( '#result' ).html( '&nbsp;' ).load( '{% url rankChange %}?studSched=' + studSched  +'&rank=' +rank);
	}

	$('.dropdown-toggle').dropdown();

	$( ".draggable" ).draggable({ revert: "invalid" });

	$( ".droppable" ).droppable({
		activeClass: "ui-state-hover",
		hoverClass: "ui-state-active",
		drop: function( event, ui ) {
			$( this ).addClass( "ui-state-highlight" );
			$(ui.draggable).hide('slow');

            $(' #tabs' ).tabs();
            $(' #tabs' ).tabs("select", 3);
			
			$.post("{% url alternate %}", { 
				alternateID : $(ui.draggable).attr("id"),
				alternateFor: $(this).attr("id"),
				csrfmiddlewaretoken: '{{ csrf_token }}'
		    	})
		    	.success(function(data) { 

		            $(' #tabs' ).tabs();
            		$(' #tabs' ).tabs("load", 3);
            		window.setTimeout(function () {
	    				$('#preRank').html(data);
			    		$('#preRank').css("display", "block");
			            $('#preRank').effect("highlight", {color:"#fffee0"}, 5000);
			            $("#preRank").delay(10000).slideUp();
					}, 500);


		     });
		}
	});
</script>
			
{% endblock %}

{% block content %}
{% csrf_token %} 

	<div id = "enrolledDiv" >
	<h3 style="text-align:center"> {{student.first_name}}'s Courses </h3>

	{%if msg %}
		<div id = "msg" class="addMessage {{messageType}} roundBorder6">
		{% for m in msg%}
			{% if forloop.counter != msg|length %}
				{{m}}<br /> In addition, 
			{% else %}
				{{m}}	
			{% endif %}
		{% endfor %}

		{% for confirm, courseConfirm in confirmationBox %}
			{% if confirm%}
				Are you sure you want to add it?
				<br />
				<input type = "submit" id = "{% if courseConfirm %}YesCourse{% else %}Yes{% endif %}" class = "button" value = "Yes"/>
				<input type = "submit" id = "No" class = "button" value = "No"/>
				<input type = "hidden" name = "{% if courseConfirm %}{{courseConfirm.courseNumber}}{% else %}{{section.id}}{% endif %}" id = "confirmType" />
				<br />
			{% endif %}
		{% endfor %}
		</div>
	{% endif %} 

<div>
{% for studSched, prd, disciplines, sectionOptions, rank, dayz, droppable, show in studentSchedules %}
{% if show %}
	<div class="{% for discipline in disciplines %} {{discipline.discipline.discipline|slugify}} {% endfor %} discipline roundBorder6 {% if droppable %}droppable{% endif %} draggable" id = "{{studSched.id}}" style = "{% if studSched.sectionID.semesterOne != studSched.sectionID.semesterTwo %}width:49.5%;{% if studSched.sectionID.semesterTwo %}float:right;{% endif %}{% else %}width:99%;{% endif %};z-index:{{forloop.revcounter|multiply:100}};clear:both;">
		<!-- {% ifchanged prd %}clear:both{% else %}{% endifchanged %}-->
		<ul id="disciplineProperties"class="nav dd" style= "max-width:80%; margin:auto;" >
			
			<li id="courseName" ><a rel ="tooltip" href = "#{{studSched.sectionID.courseID.courseName|slugify}}" id = "courseNameLink" title = "{{studSched.sectionID.courseID.courseName}}">{% if studSched.sectionID.semesterOne != studSched.sectionID.semesterTwo %}{{studSched.sectionID.courseID.courseName|truncatewords_by_chars:15}}{% else %}{{studSched.sectionID.courseID.courseName|truncatewords_by_chars:50}}{% endif %}</a></li>

			<li class="{% if sectionOptions|length != 0 %}dropdown{% else %}dropdownFalse{% endif %}" >
				<a rel = "tooltip" class="dropdown-toggle"  data-toggle="dropdown" title= "{{dayz|toDays:prd}}" {% if sectionOptions|length != 0 %}href="#"{% endif %} > {{prd}} {% if sectionOptions|length != 0 %} <b class="caret"></b> {% endif %}</a> 			
				{% if sectionOptions %}
					<ul class = "dropdown-menu">
						{% for sectionOpt, period, days in sectionOptions %}
						<li>
						<a href = "#" rel="tooltip" title= "{{days|toDays:prd}}" id="switch" onclick="switchPeriod({{sectionOpt.id}}, {{studSched.id}}); return false;">{{period}}</a>
						</li>
						{% endfor %}	
					</ul>
				{% endif %}
			</li>
		</ul>


				<input type="image" name= "{{studSched.id}}" id = "delete" class="roundButton deleteCloseButton" src="/registrationApp/site_media/Images/delete.png" />


		</div>
	{% endif %}
	{% endfor %}

</div>
{% if reqMessage %}
	{% for req, reqMsg in reqMessage %}
		<div id = "{{req.courseID}}{{req.discipline|slugify}}" style= "clear:both;" class = "required roundBorder6"><p style="line-height:5px"><i>{{reqMsg}}</i></p>
			<input type="image" {%if req.courseID %} name="{{req.courseID.courseNumber}}" id="addRequiredCourse"{% else %} name= "{{req.discipline|slugify}}" id="addRequiredDiscipline"{% endif %} class="roundButton deleteCloseButton" src="/registrationApp/site_media/Images/add.png" style="float: right;"/>
		</div>
	{% endfor %}
{% endif %}
</div>


<div style="width:99%; clear:both;">
	<input type = "submit" id = "submitAll" class = "button" value ="submit" style="margin:auto"/>
</div>


	<div id = "screen"> </div>
    <div id ="confirmation" class = "confirmationDiv">
       	<input type="image" id = "close" src="/registrationApp/site_media/Images/delete.png" class= "roundButton deleteCloseButton"/>         
        <div id = "submitConfirmationHeader" class="confirmationHeader" >
            <h1 style="display:inline; position:relative;">Submit Confirmation</h1>
        </div>
        <div class="confirmationBody" >
        	<p>You cannot unsubmit once you are done, so please double check your schedule. As soon as you press submit, your schedule will be submitted for House Advisor and then Parent approval. Are you sure you want to submit?</p> 
    
        	<div  id="warningDiv"> </div>
			    <p>Please write any additional notes here:</p> 
				<textarea id="studentNote" cols="50" rows="10"></textarea>
        </div>
        <div id = "submitConfirmation"class = "submitConfirmationButtons">
            <input type = "submit" value = "No" class = "button" id="schedSubmitNo"/>
            <input type = "submit" value = "Yes" class = "button" id ="schedSubmitYes" />
        </div>
    </div>


{%endblock%}



{% block script %}
<script type="text/javascript">
$( document ).ready( function() {
	$('.dropdown-toggle').dropdown();
	
	{% if msg %}
		$('#msg').delay(500).effect("highlight", {color:"#fffee0"}, 5000);
	{% endif %}

	$('.engHistRank').click(function() {
		$(this).children('.rankOptions').toggle();	
	});
	
	$('#Yes').click(function(){
		sec = $("#confirmType").attr("name");
		$( '#result' ).html( '&nbsp;' ).load("{% url add %}", {
			section : sec,
			confirm : 1,
			csrfmiddlewaretoken: '{{ csrf_token }}'
       	});		       	
       	$(' #tabs' ).tabs();
		$(' #tabs' ).tabs("load", 0);
       	$(' #tabs' ).tabs();
		$(' #tabs' ).tabs("select", 0);
	});


	$('#YesCourse').click(function(){
		course = $("#confirmType").attr("name");
		$( '#result' ).html( '&nbsp;' ).load("{% url add %}", {
			course : course,
			confirm : 1,
			csrfmiddlewaretoken: '{{ csrf_token }}'
       	}).hide().fadeIn('slow');
       	$(' #tabs' ).tabs();
		$(' #tabs' ).tabs("load", 0);
		$(' #tabs' ).tabs();
		$(' #tabs' ).tabs("select", 0);
	});

	$('#No').click(function(){
		$("#msg").slideUp();
	});

	{% if messageType != "warning" %}
		$("#msg").delay(10000).slideUp();
	{% endif %}
});
</script>
{% endblock %}