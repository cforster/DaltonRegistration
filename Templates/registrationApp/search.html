{% extends "registrationApp/headerBase.html" %}

{% block headerscript %}
	<link type="text/css" href="/registrationApp/site_media/CSS/jquery-ui-1.8.18.custom.css" rel="stylesheet" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
{% endblock %}

{% block content %}

{% if student.advisorNote and not student.advisorNoteRead or student.parentNote and not student.parentNoteRead %}
    <div id= "screen"></div>
    <div id ="notification" class = "confirmationDiv">
    <input type="image" id = "close2" class="roundButton deleteCloseButton" src="/registrationApp/site_media/Images/delete.png"/>            
        <div class="confirmationHeader roundBorderTopRight roundBorderTopLeft">
            <h1 style="display:inline; position:relative;"> Notifications </h1>
        </div>
        <div class= "confirmationBody">
            {% if student.advisorNote and not student.advisorNoteRead %}
                Advisor's Note:  <br />{{student.advisorNote}}<br /> <br />
            {% endif %}
               
            {% if student.parentNote and not student.parentNoteRead  %}   
                Parent's Note: <br /> {{student.parentNote}} <br /> <br />
            {% endif %}
        </div>

        <div class = "submitConfirmationButtons roundBorderBottomLeft roundBorderBottomRight">
            <input type = "submit" value = "OK" class = "button" id="readNotifications" />
        </div>
    </div>

{% endif %}


<div class="container-fluid">
    <div class="row-fluid">
        <div class="span4">
            <div id = "leftColumnTop" class = "leftDiv leftColumnTop">
                
                <input type="text" name="search" id= "searchBox" autocomplete="off" placeholder="Enter a Course, Discipline, or Period" />
        
<span id="spinner" style="display:inline; height:20px;"><img src="/registrationApp/site_media/Images/spinner.gif"/></span>
      
                <div id="results" style="width:100%;" class="scroll">
                    <!--<div id = "overlay" > </div> <!-->
                </div>
            </div>
  
            <div id="result" class="leftDiv ">

            </div>
                

        </div><!--/span-->
                	

        <div class="span8">
            <div id= "tabs" class="rightDiv" >
                <ul class="tabs">
                    <li id = "tab1"><a href="{% url one %}" title="instructions">instructions</a></li>
                    <li id = "tab2"><a href="#tabs2">schedule</a></li>
                    <li id = "tab3"><a href="{% url catalog %}" title ="catalog">catalog</a></li>
                    <li id = "tab4"><a href="{% url preferences %}" title"preferences">preferences</a></li>
                </ul>
                <div id = "instructions"> </div> 
                <div id="tabs2">
                    <p>schedule</p>
                </div>
                <div id = "catalog"> </div> 
                <div id = "preferences"> </div> 


            </div>
        </div>
              
    </div><!--/row-->
</div>
 
{% endblock %}

{% block script %}

<script type="text/javascript">
$( document ).ready( function() {
    var  mouseHover;
    $('a[rel=tooltip], #tool').live("mouseenter", function(e){
        $anchor = $(this);
        mouseHover = true;
        var tip = $(this).attr('title');
        $(this).removeAttr('title');
        if (mouseHover == true){
                var offset = $(this).offset();
                var width = $(this).outerWidth();
                $(this).append($('<div id="tooltip" class="roundBorder6">' + tip + '</div>').stop().show(980).hide().fadeIn('slow'));
                var timer3;
                function showTip(){ 
                    $('#tooltip').css("left", (offset.left + (width)/2 - ($('#tooltip').outerWidth() ) /2 ));
                    $('#tooltip').css("top", (offset.top + 28));
                }

            timer3 && clearTimeout(timer3);
            timer3 = setTimeout(showTip, 1000);
        }
    });
    var width = $(this).outerWidth();
    $('a[rel=tooltip], #tool').live("mouseleave", function(e){
        mouseHover = false;
        $(this).attr('title',$('#tooltip').html());
        $(this).children('div#tooltip').remove();
    });

    $(document).on("click","#notif", function(e){
        e.stopPropagation(); 
        $('#notif').toggleClass("slide");
        $('#notif').toggleClass("sel");
        $('#notifA').toggleClass("notifButtonSelected");

        if ($('#notifDiv').is(":hidden")){
                $('#notifDiv').slideDown("slow");
                $('#notifDiv').load('{% url notifications %}')
                nDiv.data("loaded", true);
            } else {
                $('#notifDiv').slideUp("slow");       

            }
    });
    $(document).on("click","#notifDiv", function(e){
        e.stopPropagation(); 
    });


    $(document).on("click", function(){
        if (!($('#notifDiv').is(":hidden"))){
            $('#notif').toggleClass("slide");
            $('#notif').toggleClass("sel");
            $('#notifA').toggleClass("notifButtonSelected");
            $('#notifDiv').slideUp("slow");       
        }
    });


  
	$('#searchBox').focus();	
    {% if student.submit %}

        $('#result').load('{% url studentSchedule %}', {
            student: {{student.id}},
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }).hide().fadeIn('slow');
        
    {% else %}
    $('#result').load('{% url add %}').hide().fadeIn('slow');

    {% endif %}  
	{% if student.advisorNote != " " and student.advisorNoteRead == 0 or  student.parentNote != " " and student.parentNoteRead == 0  %}
		$('#screen').css({"display": "block", "opacity": 0.7}).hide().fadeIn('slow');    
   		$('#notification').css({"display": "block"}).hide().fadeIn('slow');
	{% endif %}


    var runningRequest = false;
    var request;
	
    var search = ($("#searchBox").val());
	
    $('#searchBox').keyup(function(e){
		e.preventDefault();
        lastKeyPressCode = e.keyCode;
		var newVal = ($("#searchBox").val());
		if (newVal != search) {
            typewatch(function () {
    			search = newVal;
                q = search;
                if(runningRequest){
                    request.abort();
                }

                runningRequest=true;
                request =$.post("{% url searchResults %}", { q : q,  csrfmiddlewaretoken: '{{ csrf_token }}'},
               function(data) {
                    $( '#results' ).html(data);
                    runningRequest=false;
               });
            }, 300);
		}
	});
    var typewatch = (function(){
    var timer = 0;
    return function(callback, ms){
        clearTimeout (timer);
        timer = setTimeout(callback, ms);
    }  
    })();

	$(' #tabs' ).tabs();
	$(' #tabs' ).tabs("load", 0);


	$(document).on("click", "#searchResults>a, #courseNameLink", function(f){
		f.preventDefault();
		$('#tabs' ).tabs();
		$('#tabs' ).tabs("select", 2);
		var scrollto = $($(this).attr('href')).position().top + $('#courseCatalog').scrollTop() -50;
		$('#courseCatalog').stop(true).animate({ scrollTop: scrollto }, 1000);
		$($(this).attr('href')).delay(700).effect("highlight", {color:"#fffee0"}, 4000);
	});

    $(document).on("click", "#addSection", function(){
		$( '#result' ).html( '&nbsp;' ).load("{% url add %}", {
			section: $(this).attr("name"),
			csrfmiddlewaretoken: '{{ csrf_token }}'
       	}).hide().fadeIn('slow');
    });
    $(document).on("click", "#delete", function(){

        $.post("{% url delete %}", { 
            studSched : $(this).attr("name"),
            csrfmiddlewaretoken: '{{ csrf_token }}'
        })
        .success(function(data) {
            $( '#result' ).html(data).hide().fadeIn('slow');
            $(' #tabs' ).tabs();
            $(' #tabs' ).tabs("load", 0);
            $(' #tabs' ).tabs();
            $(' #tabs' ).tabs("load", 3);

        });

    });
	
    $(document).on("click", "#searchElement", function(){
		$('#searchResults #searchElement' ).removeClass('selectedDiv');
		$(this).toggleClass('selectedDiv');
	});
	function closeConfirmation(x){
		$(x).fadeOut('slow',function(){
			$(this).css({"display": "none"});
		});
	}

    $(document).on("click", "#submitAll", function(){
        $('#screen').css({"display": "block", "opacity": 0.7}).hide().fadeIn('slow');    
        $('#confirmation').css({"display": "block"}).hide().fadeIn('slow');
        $( '#warningDiv' ).html( '&nbsp;' ).load("{% url warningOutput %}")
    }); 

	$(document).on("click", "#schedSubmitYes", function(){
        $('#tabs' ).tabs();
        $('#tabs' ).tabs("select", 0);
		
        $.post("{% url submit %}", {
            studentNote : $('#studentNote').val(), 
            csrfmiddlewaretoken: '{{ csrf_token }}'
        })
        .success(function(data) { 
            $( '#instructions' ).html(data);
            $( '#result' ).html( '&nbsp;' ).load('{% url studentSchedule %}',{
                student : {{student.id}},
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }).hide().fadeIn('slow');
        });
        closeConfirmation($("#screen"));
        closeConfirmation($("#confirmation"));
	});

	$(document).on("click", "#schedSubmitNo, #close", function(){
        closeConfirmation($("#screen"));
        closeConfirmation($("#confirmation"));
	});

	$(document).on("click", "#cancel, #close2", function(){
		closeConfirmation($("#notification"));
        closeConfirmation($("#screen"));
	});

    $(document).on("click", "#addRequiredCourse", function(){
        $( '#result' ).html( '&nbsp;' ).load("{% url add %}", {
            course : $(this).attr("name"),
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }).hide().fadeIn('slow');

    });

    $(document).on("click", "#addRequiredDiscipline", function(){
        disc = $(this).attr("name");

        $( '#results' ).html( '&nbsp;' ).load("{% url searchResults %}", {
            q : disc,
            onlyDisciplineSearch : 1,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        }).hide().fadeIn('slow');
        $('#searchBox').val(disc);

    });

	$(function() {
		$( "#tabs" ).tabs({
			ajaxOptions: {
				error: function( xhr, status, index, anchor ) {
					$( anchor.hash ).html(
						"Could not load this tab. Please Refresh the page.");
				}
			}
		});
	});
    var width = $('#centerHeader').outerWidth();
    $('#centerHeader').css("margin-left", (-(width)/2));


	$(document).on("click", "#readNotifications", function(){
        var notes = "";
		{% if student.advisorNote and not student.advisorNoteRead %}
			notes += "advisorNote,";
	   	{% endif %}
		   
        {% if student.parentNote and not student.parentNoteRead %} 
            notes += "parentNote";
        {% endif %}

        $.post( "{% url notifRead %}",{
            note : notes,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        function(data){
            $('#alert').append(data).effect("highlight", {color:"#fffee0"}, 2000).delay(6000).hide(2000);
        });
	    closeConfirmation($("#notification"));
        closeConfirmation($("#screen"));
	});
    $(' #tabs' ).tabs();
    $(' #tabs' ).tabs("load", 2);
});

$(document).ajaxStart( function() {
	$( '#spinner' ).show();
}).ajaxStop( function() {
	$( '#spinner' ).hide();
});

</script>


{%endblock%}